[SERVICE]
    Flush        1
    Daemon       Off
    Log_Level    info
    Parsers_File parsers.conf

# ---------------------------------
# INPUT: TAIL DOCKER CONTAINERS
# ---------------------------------
[INPUT]
    Name              tail
    Path              /var/lib/docker/containers/*/*-json.log
    Parser            docker
    Tag               docker.*
    Docker_Mode       On
    Mem_Buf_Limit     10MB
    Skip_Long_Lines   On
    Refresh_Interval  5

# ---------------------------------
# FILTER 1: only selected containers (your manta servers)
# ---------------------------------
[FILTER]
    Name   grep
    Match  docker.*
    Regex  container_name (manta-vllm-server|manta-vllm-server-2)

# ---------------------------------
# FILTER 2: only ERROR / EXCEPTION
# ---------------------------------
[FILTER]
    Name   grep
    Match  docker.*
    Regex  log (?i)(error|exception)

# Add hostname field
[FILTER]
    Name   record_modifier
    Match  docker.*
    Record host ${HOSTNAME}

# ---------------------------------
# OUTPUT: LOKI
# ---------------------------------
[OUTPUT]
    Name          loki
    Match         docker.*
    Host          loki
    Port          3100
    Labels        container_name=$container_name,host=$HOSTNAME
    Line_Format   json
