[SERVICE]
    Flush        1
    Log_Level    info
    Parsers_File parsers.conf

# Tail docker logs
[INPUT]
    Name              tail
    Path              /var/lib/docker/containers/*/*-json.log
    Parser            docker
    Tag               logs.docker.*
    Refresh_Interval  5
    Skip_Long_Lines   On

[INPUT]
    Name      forward
    Listen    0.0.0.0
    Port      ${FLB_FORWARD_PORT}
    Tag       logs.forward.*

# Add hostname
[FILTER]
    Name              record_modifier
    Match             *
    Record            host ${HOSTNAME}

# Only keep lines that match the configured pattern
[FILTER]
    Name   grep
    Match  logs.*
    Regex  log ${LOG_INCLUDE_REGEX}

# Copy error/exception lines to alerts.* tags for dedicated routing
[FILTER]
    Name          rewrite_tag
    Match         logs.*
    Rule          log ${LOG_ALERT_REGEX} alerts.$TAG true
    Emitter_Name  error_router

# Output â†’ OpenObserve
[OUTPUT]
    Name              http
    Match             logs.*
    Host              ${OO_HTTP_HOST}
    Port              ${OO_HTTP_PORT}
    URI               /api/${OO_ORG}/${OO_STREAM_LOGS}/_json
    Format            json
    Json_date_key     timestamp
    Json_date_format  iso8601
    Header            Content-Type application/json
    Header            Authorization ${OO_AUTH_HEADER}

# Error-only stream for alert queries
[OUTPUT]
    Name              http
    Match             alerts.*
    Host              ${OO_HTTP_HOST}
    Port              ${OO_HTTP_PORT}
    URI               /api/${OO_ORG}/${OO_STREAM_ALERTS}/_json
    Format            json
    Json_date_key     timestamp
    Json_date_format  iso8601
    Header            Content-Type application/json
    Header            Authorization ${OO_AUTH_HEADER}
