[SERVICE]
    Flush        1
    Log_Level    info
    Parsers_File parsers.conf
    storage.path        /fluent-bit/state
    storage.sync        normal
    storage.checksum    On
    storage.backlog.mem_limit ${FLB_STORAGE_TOTAL_LIMIT}

# Tail docker logs
[INPUT]
    Name              tail
    Path              /var/lib/docker/containers/*/*-json.log
    Parser            docker
    Tag               docker.*
    Refresh_Interval  5
    Skip_Long_Lines   On
    DB                /fluent-bit/state/docker-containers.db
    DB.Sync           normal
    Mem_Buf_Limit ${FLB_TAIL_MEM_BUF_LIMIT}

# Stitch stack traces together so alert routing sees full messages
[FILTER]
    Name                multiline
    Match               docker.*
    multiline.key_content log
    multiline.parser    stacktrace

# Only keep lines that contain error/exception/traceback keywords
[FILTER]
    Name   grep
    Match  docker.*
    Regex  log ${LOG_ERROR_REGEX}

# Record host name for context
[FILTER]
    Name              record_modifier
    Match             docker.*
    Record            host ${HOSTNAME}

# Output â†’ OpenObserve
[OUTPUT]
    Name              http
    Match             docker.*
    Host              ${OO_HTTP_HOST}
    Port              ${OO_HTTP_PORT}
    URI               /api/${OO_ORG}/${OO_STREAM}/_json
    Format            json
    Json_date_key     _timestamp
    Json_date_format  iso8601
    tls               ${OO_HTTP_TLS}
    compress          ${OO_HTTP_COMPRESS}
    Header            Content-Type application/json
    HTTP_User         ${OO_HTTP_USER}
    HTTP_Passwd       ${OO_HTTP_PASSWORD}
